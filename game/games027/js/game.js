!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="./",s(s.s=1)}([function(t,e){t.exports=function(t,e,s){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var i=e.split("."),n=t,r=s,a=0;a<i.length;a++){if(!n.hasOwnProperty(i[a])){r=s;break}r=n[i[a]],n=n[i[a]]}return r}return s}return s}},function(t,e,s){"use strict";s.r(e);class i extends Phaser.Scene{constructor(){super("boot")}preload(){this.load.image("loading","../Mark/preloader.gif"),this.load.image("dauchung","../Mark/dauchung.png"),this.load.spritesheet("walk","./assets/walk.png",{frameWidth:90,frameHeight:90})}create(){this.scene.start("load")}}class n extends Phaser.Scene{constructor(){super("load")}setPreloadSprite(t){this.preloadSprite={sprite:t,width:t.width,height:t.height},this.load.on("progress",this.onProgress,this);var e=this.loadingbar.width*this.loadingbar.scaleX;this.walk=this.add.sprite(0,game.config.height/2+90,"walk"),this.startX=this.loadingbar.x-e/2,this.walk.x=this.startX,this.anims.create({key:"walking",frames:this.anims.generateFrameNumbers("walk",{start:0,end:4}),frameRate:8,repeat:-1}),this.walk.play("walking")}onProgress(t){if(this.preloadSprite){let e=Math.floor(this.preloadSprite.width*t);this.preloadSprite.sprite.frame.width=e<=0?1:e,this.preloadSprite.sprite.frame.cutWidth=e,this.walk.x=this.startX+.95*e,this.preloadSprite.sprite.frame.updateUVs()}}preload(){this.add.sprite(game.config.width/2,.4*game.config.height,"dauchung"),this.loadingbar=this.add.sprite(game.config.width/2,.65*game.config.height,"loading"),this.setPreloadSprite(this.loadingbar),this.load.image("press","../Mark/press.png"),this.load.image("cover","../Mark/cover01.png"),this.load.spritesheet("stamp","../Mark/stamp.png",{frameWidth:150,frameHeight:150}),this.load.spritesheet("waiting","../Mark/waiting.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("saving","../Mark/saving.png",{frameWidth:300,frameHeight:300}),this.load.image("menu","./assets/menu.png"),this.load.image("background","./assets/background.png"),this.load.image("bulb","./assets/bulb.png"),this.load.image("teach","./assets/teach.png"),this.load.image("end_bg","./assets/end_bg.png"),this.load.image("end0","./assets/end0.png"),this.load.image("end1","./assets/end1.png"),this.load.image("end2","./assets/end2.png"),this.load.image("end3","./assets/end3.png"),this.load.image("end4","./assets/end4.png"),this.load.spritesheet("logo","./assets/logo.png",{frameWidth:430,frameHeight:130}),this.load.spritesheet("menu_player","./assets/menu_player.png",{frameWidth:350,frameHeight:360}),this.load.spritesheet("win","./assets/win.png",{frameWidth:350,frameHeight:350}),this.load.spritesheet("fail","./assets/fail.png",{frameWidth:350,frameHeight:350}),this.load.spritesheet("desserts","./assets/desserts.png",{frameWidth:110,frameHeight:110}),this.load.image("costbanner","./assets/ban_cost.png"),this.load.image("freebanner","./assets/ban_free.png"),this.load.image("tipsbanner","./assets/ban_tips.png"),this.load.image("relivebanner","./assets/ban_relive.png"),this.load.spritesheet("playBtn","./assets/playBtn.png",{frameWidth:185,frameHeight:105}),this.load.spritesheet("startBtn","./assets/startBtn.png",{frameWidth:130,frameHeight:70}),this.load.spritesheet("cancleBtn","./assets/cancleBtn.png",{frameWidth:130,frameHeight:70}),this.load.spritesheet("storeBtn","./assets/storeBtn.png",{frameWidth:130,frameHeight:70}),this.load.spritesheet("okBtn","./assets/okBtn.png",{frameWidth:130,frameHeight:70}),this.load.spritesheet("noBtn","./assets/noBtn.png",{frameWidth:130,frameHeight:70}),this.load.spritesheet("home","./assets/btn_home.png",{frameWidth:100,frameHeight:110}),this.load.spritesheet("login","./assets/btn_login.png",{frameWidth:100,frameHeight:110}),this.load.spritesheet("rank","./assets/btn_rank.png",{frameWidth:100,frameHeight:110}),this.load.spritesheet("bag","./assets/btn_bag.png",{frameWidth:100,frameHeight:110}),this.load.spritesheet("restart","./assets/btn_restart.png",{frameWidth:100,frameHeight:110}),this.load.bitmapFont("BMFont","../Font/BMFont_Black.png","../Font/BMFont_Black.fnt"),this.load.bitmapFont("BMFont_desserts","./assets/dessertsText_Black.png","./assets/dessertsText_Black.fnt"),this.load.audio("bgmSE","./assets/audio/bgm.mp3"),this.load.audio("waitingSE","./assets/audio/waiting.mp3"),this.load.audio("clickStartSE","./assets/audio/clickStart.mp3"),this.load.audio("clickSE","./assets/audio/click.mp3"),this.load.audio("matchSE","./assets/audio/match.mp3"),this.load.audio("bonusSE","./assets/audio/bonus.mp3"),this.load.audio("winSE","./assets/audio/win.mp3"),this.load.audio("failSE","./assets/audio/fail.mp3")}create(){this.scene.start("menu")}}function r(t,e,s){var i=t.sound.add(e,{volume:s});try{i.play()}catch(t){}}function a(t,e){return e.setFrame(1),r(t,"clickSE"),e.input.enabled=!1,t.tweens.add({targets:e,scale:{from:.8,to:1},duration:100,ease:"Bounce.Out",callbackScope:this,onComplete:function(){e.setFrame(0)}})}var h,o;class d extends Phaser.Scene{constructor(){super("menu")}init(){}create(){this.scene.bringToTop(),this.add.sprite(0,0,"menu").setOrigin(0),this.anims.create({key:"menu_logo",frames:this.anims.generateFrameNumbers("logo",{start:0,end:4}),frameRate:6,repeat:-1});var t=this.add.sprite(game.config.width/2,-150,"logo");t.play("menu_logo"),this.tweens.add({targets:t,y:120,duration:1e3,ease:"Bounce.Out"}),this.anims.create({key:"menu_player",frames:this.anims.generateFrameNumbers("menu_player",{start:0,end:4}),frameRate:6,repeat:-1}),this.add.sprite(game.config.width/2+20,game.config.height/2+15,"menu_player").play("menu_player"),(h=this.add.sprite(game.config.width/2,game.config.height/2+300,"playBtn",0)).setInteractive().on("pointerdown",(function(){a(this,h).on("complete",(function(){h.setVisible(!1),this.scene.start("teach")}),this)}),this)}}class c extends Phaser.Scene{constructor(){super("teach")}init(){}create(){this.scene.bringToTop();var t=this.add.sprite(0,0,"teach").setOrigin(0).setInteractive();t.on("pointerdown",(function(){r(this,"clickStartSE"),t.disableInteractive(),this.scene.start("play"),this.time.addEvent({delay:3e3,callback:function(){t.setVisible(!1)},callbackScope:this})}),this)}}var l,p,g,u,m;class v extends Phaser.Scene{constructor(){super("play")}init(){this.speedUpTimes=0,this.quicked=!1,this.relived=!1,this.gamesIsOver=!1,g=3,this.currentTime=30,this.lastDownTime=0,o=0,"",l=0,p=0}create(){this.scene.bringToTop(),this.background=this.add.sprite(0,0,"background").setOrigin(0),this.scoreText=this.add.bitmapText(75,50,"BMFont",o,20).setOrigin(.5),this.cover=this.add.sprite(0,0,"cover").setOrigin(0).setDepth(1),this.anims.create({key:"waiting",frames:this.anims.generateFrameNumbers("waiting",{start:0,end:59}),duration:3e3,hideOnComplete:!0}),r(this,"waitingSE",.5);var t=this.add.sprite(game.config.width/2,game.config.height/2,"waiting");t.depth=1,t.anims.play("waiting"),this.time.addEvent({delay:1e3,callback:function(){0==--g&&(this.gameStart(),this.cover.destroy(!0))},callbackScope:this,repeat:3}),this.createDessert()}update(){this.gamesIsOver||this.input.activePointer.isDown&&!this.inAction&&null!=this.fallingContainer&&this.fallingContainer.y>=120&&Date.now()-this.lastDownTime>600&&(this.quicked=!0,this.speedUpTimes+=1,this.inAction=!0,this.fallTween.timeScale=5,this.background.disableInteractive())}createDessert(){this.dessertsContainer=this.add.container(game.config.width/2,700),this.dessertsArray=[],this.dessertsPos=[{x:-80,y:-80},{x:80,y:-80},{x:80,y:80},{x:-80,y:80}];for(var t=0;t<4;t++){var e=this.add.sprite(this.dessertsPos[t].x,this.dessertsPos[t].y,"desserts",t);this.dessertsContainer.add(e),this.dessertsArray.push(e)}}updateCounter(){this.timerEvents=this.time.addEvent({delay:1e3,callback:function(){this.currentTime-=1,this.currentTime=this.currentTime.toString().padStart(2,"0"),this.timeText.setText("00："+this.currentTime),this.currentTime<=10&&this.tweens.add({targets:this.timeText,scale:"+=0.1",duration:300,yoyo:!0,repeat:0}),this.currentTime<1&&this.gameOver()},callbackScope:this,loop:!0})}gameStart(){var t=this.add.sprite(0,900,"bulb").setOrigin(0,1),e=void 0,s=void 0;this.tweens.addCounter({from:100,to:0,duration:3e3,repeat:-1,onUpdate:function(i){const n=Math.floor(i.getValue());if(n%25==0&&s!=n){s=n;var r=[[210,210,255],[255,165,255],[255,210,165],[210,255,255]];do{var a=Phaser.Math.Between(0,r.length-1)}while(e==a);e=a,t.setTint(Phaser.Display.Color.GetColor(r[a][0],r[a][1],r[a][2]))}}}),this.soundBgm=this.sound.add("bgmSE",{loop:-1}),this.soundBgm.play(),this.createFallingContainer();var i,n,r,a;this.background.setInteractive(),this.background.on("pointerdown",(function(t){if(0==this.background.input.enabled)return;let e=Date.now()-this.lastDownTime;this.lastDownTime=Date.now(),e<250?(this.inAction=!0,this.lastDownTime=0,this.handleTap()):(this.inAction=!1,i=t.x,r=t.y)}),this),this.background.on("pointerup",(function(t){0!=this.background.input.enabled&&(n=t.x,a=t.y,n<i-80?this.handleSwipe("left"):n>i+80?this.handleSwipe("right"):a<r-80?this.handleSwipe("left"):a>r+80&&this.handleSwipe("right"))}),this)}showFrame(t){t}createFallingContainer(){this.quicked=!1,this.fallingContainer=this.add.container(game.config.width/2,-50);for(var t=[0,1,2,3],e=0;e<2;e++){var s;s=0==e?-80:80;var i=Phaser.Math.Between(0,t.length-1);this.showFrame(t[i]);var n=this.add.sprite(s,0,"desserts",t[i]);this.fallingContainer.add(n),t.splice(i,1)}this.falling()}falling(){this.fallTween=this.tweens.add({targets:this.fallingContainer,y:540,duration:3200,callbackScope:this,onComplete:function(t,e){if(0==this.quicked&&(this.speedUpTimes=0),this.fallingContainer.list[0].frame.name==this.dessertsArray[0].frame.name&&this.fallingContainer.list[1].frame.name==this.dessertsArray[1].frame.name){if(this.background.setInteractive(),r(this,"matchSE"),this.handleMatch(),3==this.speedUpTimes){r(this,"bonusSE",1.3);var s=this.add.bitmapText(game.config.width/2,game.config.height/2,"BMFont_desserts","BONUS+5",30).setOrigin(.5);this.tweens.add({targets:s,y:"-=20",alpha:0,duration:500,hideOnComplete:!0},this),o+=5,this.speedUpTimes=0,p+=1}else r(this,"matchSE"),o+=2,l+=1;this.scoreText.setText(o)}else this.background.disableInteractive(),this.gameOver(),this.backTween=this.tweens.add({targets:this.fallingContainer,y:-50,duration:300})}},this)}handleMatch(){this.fallingContainer.destroy(),this.tweens.add({targets:[this.dessertsArray[0],this.dessertsArray[1]],scale:1.1,duration:200,ease:"Bounce.InOut",yoyo:!0}),this.createFallingContainer()}handleTap(){this.background.disableInteractive(),this.showFrame(this.dessertsArray[0].frame.name),this.showFrame(this.dessertsArray[1].frame.name);var t=0;this.tweens.add({targets:this.dessertsArray[0],x:this.dessertsArray[0].x+160,duration:200,ease:"Cubic.Out",callbackScope:this,onComplete:function(e,s){t+=1,this.tempSprite(t)}}),this.tweens.add({targets:this.dessertsArray[1],x:this.dessertsArray[1].x-160,duration:200,ease:"Cubic.Out",callbackScope:this,onComplete:function(e,s){t+=1,this.tempSprite(t)}})}tempSprite(t){if(2==t){var e=this.dessertsArray[0];this.dessertsArray[0]=this.dessertsArray[1],this.dessertsArray[1]=e,this.gamesIsOver||this.background.setInteractive()}}handleSwipe(t){this.inAction=!0,this.background.disableInteractive();for(var e="right"==t?-90:90,s=0;s<4;s++)this.add.tween({targets:this.dessertsArray[s],angle:e,duration:100});var i="right"==t?90:-90,n=this.dessertsContainer.angle+i;this.tweens.add({targets:this.dessertsContainer,angle:n,duration:200,ease:"Cubic.Out",callbackScope:this,onComplete:function(t,e){90==i?Phaser.Utils.Array.RotateRight(this.dessertsArray):Phaser.Utils.Array.RotateLeft(this.dessertsArray),this.dessertsContainer.angle=0;for(var s=0;s<4;s++)this.dessertsArray[s].setPosition(this.dessertsPos[s].x,this.dessertsPos[s].y),this.dessertsArray[s].setAngle(0);this.gamesIsOver||this.background.setInteractive()}},this)}gameOver(){this.tweens.add({targets:this.soundBgm,volume:0,duration:2e3}),this.cover=this.add.sprite(0,0,"cover").setOrigin(0),this.gamesIsOver=!0,this.fallTween.stop(),this.fallingContainer.removeAll(!0),this.background.disableInteractive();var t=2..toString().padStart(3,"0"),e=5..toString().padStart(3,"0"),s=l.toString().padStart(3,"0"),i=p.toString().padStart(3,"0");t+e+s+i,this.tweenEndBoard()}tweenEndBoard(){this.anims.create({key:"saving",frames:this.anims.generateFrameNumbers("saving",{start:0,end:9}),frameRate:6,repeat:-1}),r(this,"failSE"),this.anims.create({key:"fail",frames:this.anims.generateFrameNumbers("fail",{start:0,end:4}),frameRate:8,repeat:-1});var t=this.add.sprite(game.config.width/2,0,"fail");t.depth=1,t.play("fail"),this.tweens.add({targets:t,y:game.config.height/2-50,duration:1e3,ease:"Bounce.Out",callbackScope:this,onComplete:function(t,e){this.time.addEvent({delay:800,callback:function(){var t=this.add.sprite(game.config.width/2,game.config.height/2,"saving");t.depth=1,t.setScale(.5),t.anims.play("saving"),this.time.addEvent({delay:400,callback:function(){this.scene.start("over")},callbackScope:this})},callbackScope:this})}})}}class f extends Phaser.Scene{constructor(){super("over")}init(){}create(){this.scene.bringToTop(),this.add.sprite(0,0,"end_bg").setOrigin(0),this.scorebannerGroup=this.add.group();var t=this.add.sprite(game.config.width/2-170,game.config.height/2+120,"stamp");t.alpha=0,t.depth=5,this.anims.create({key:"stamping",frames:this.anims.generateFrameNumbers("stamp",{start:0,end:8}),frameRate:12});var e=Phaser.Math.Between(0,4);this.add.sprite(game.config.width/2,game.config.height/2-70,"end"+e),this.add.bitmapText(game.config.width/2+100,game.config.height/2+190,"BMFont_desserts",["破壞之手的你","有少女心的你","非常執著的你","喜愛玩耍的你","偷偷隱宅的你"][e],26).setOrigin(.5),this.add.bitmapText(game.config.width/2+100,game.config.height/2+250,"BMFont_desserts",["參加一場黑暗料理派對\n讓甜點通通變神秘生物\n這也許是某種天份呢！","參加了一場粉嫩草莓派對\n以為自己藏得很好沒人發現\n殊不知你的好友在瘋狂偷拍！","參加了一場抹茶控的派對\n有人帶著綠色蔬果汁走進來\n結果你盯著對方一整場！","參加了一場Q彈的布丁派對\n看誰ㄉㄨㄞ~的最高誰獲勝\n開心的你連肚子都跑出來了！","參加了一場巧克力魔法派對\n派對上充滿著神秘氣息\n導致你的中二魂大暴走！"][e],20).setOrigin(.5),this.add.bitmapText(game.config.width/2-150,game.config.height/2+245,"BMFont",o,28).setOrigin(.5),(u=this.scorebannerGroup.create(game.config.width/2+165,game.config.height-85,"home",0)).setInteractive().on("pointerdown",(function(){m.input.enabled=!1,a(this,u),setTimeout((function(){window.history.back()}),200)}),this),(m=this.scorebannerGroup.create(game.config.width/2,game.config.height-85,"restart",0)).setInteractive().on("pointerdown",(function(){u.input.enabled=!1,a(this,m),this.time.addEvent({delay:400,callback:function(){this.scene.start("menu")},callbackScope:this})}),this)}}class b{constructor(t){this.scene=t}static register(t,e){b.prototype[t]=e}}var w=b,y={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const S=Phaser.Utils.Objects.GetValue;class E{constructor(t,e){this.parent=t,this._isRunning=!1,this.tickingState=!1,this.setEventEmitter(S(e,"eventEmitter",void 0)),this.setTickingMode(S(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(t){"string"==typeof t&&(t=D[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(){this.isRunning=!1,this.emit("complete",this.parent,this)}}Object.assign(E.prototype,y);const D={no:0,lazy:1,always:2};var T=E;const x=Phaser.Scene;var O=function(t){return t instanceof x},P=function(t){return O(t)?t:t.scene&&O(t.scene)?t.scene:t.parent&&t.parent.scene&&O(t.parent.scene)?t.parent.scene:void 0};const k=Phaser.Utils.Objects.GetValue;const _=0,C=1,M="IDLE";var B=class extends T{constructor(t,e){var s=P(t);s===t&&(t=void 0),super(s,e),this.scene=s,this.gameObject=t,t&&t.setInteractive(k(e,"inputConfig",void 0)),this._enable=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(k(t,"enable",!0)),void 0===this.gameObject?this.bounds=k(t,"bounds",void 0):this.bounds=void 0,this.tracerState=_,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.gameObject?this.gameObject.off("pointerdown",this.onPointerDown,this):this.scene&&this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene&&(this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0,this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown()}destroy(){this.shutdown()}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.dragCancel(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}onPointerDown(t,e){this.enable&&(void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=C,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart()))}onPointerUp(t){this.enable&&((!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.movedState=!1,this.tracerState=_,this.onDragEnd()))}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),s=this.pointer===t;!s&&e||(s&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===C&&this.onDragEnd(),this.pointer=void 0,this.tracerState=_,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.events.on("preupdate",this.preUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.events.off("preupdate",this.preUpdate,this),this.scene.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=M,this}},I=s(0),j=s.n(I);class R{constructor(t){var e=j()(t,"states",void 0);e&&this.addStates(e);var s=j()(t,"extend",void 0);if(s)for(var i in s)this.hasOwnProperty(i)&&void 0!==this[i]||(this[i]=s[i]);var n=j()(t,"eventEmitter",void 0),r=j()(t,"EventEmitterClass",void 0);this.setEventEmitter(n,r),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(j()(t,"enable",!0)),this.start(j()(t,"start",void 0));var e=j()(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,s=this[e];s&&s.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var i="enter_"+this._state,n=this[i];n&&n.call(this),this.emit(i,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}addState(t,e){var s=j()(e,"next",void 0);s&&(this["next_"+t]=s);var i=j()(e,"exit",void 0);i&&(this["exit_"+t]=i);var n=j()(e,"enter",void 0);return n&&(this["enter_"+t]=n),this}addStates(t){for(var e in t)this.addState(e,t[e]);return this}update(t,e,s){void 0===s&&(s="update");var i=this[s+"_"+this.state];i&&i.call(this,t,e)}preupdate(t,e){this.update(t,e,"preupdate")}postupdate(t,e){this.update(t,e,"postupdate")}}Object.assign(R.prototype,y);var A=R;const F=Phaser.Utils.Objects.GetValue,N=Phaser.Math.Distance.Between;const G="IDLE",U="BEGIN",X="RECOGNIZED";var Y=class extends B{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.stop(),s.tapsCount=0,s.x=0,s.y=0,s.worldX=0,s.worldY=0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.start(),s.tapsCount=0,s.emit("tappingstart",s,s.gameObject,s.lastPointer)}},RECOGNIZED:{enter:function(){s.start(),s.emit("tap",s,s.gameObject,s.lastPointer),s.emit(s.tapsCount+"tap",s,s.gameObject,s.lastPointer)}}},init:function(){this.state=G},eventEmitter:!1};this.setRecongizedStateObject(new A(i))}resetFromJSON(t){super.resetFromJSON(t),this.setMaxHoldTime(F(t,"time",250)),this.setTapInterval(F(t,"tapInterval",200)),this.setDragThreshold(F(t,"threshold",9)),this.setTapOffset(F(t,"tapOffset",10));var e=F(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(F(t,"maxTaps",void 0)),this.setMinTaps(F(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case G:this.state=U;break;case U:var t=this.lastPointer;N(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=X,this.state=U);break;case X:this.state=U}}onDragEnd(){this.state===U&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=X))}onDrag(){this.state!==G&&this.pointer.getDistance()>this.dragThreshold&&(this.state=G)}preUpdate(t,e){if(this.state===U){var s=this.lastPointer;if(s.isDown)t-s.downTime>this.holdTime&&(this.state=G);else t-s.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=X:this.state=G)}}postUpdate(t,e){this.state===X&&(this.state=G)}get isTapped(){return this.state===X}setMaxHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}},V=function(t){return null==t||""===t||0===t.length},W=function(t,e,s){if("object"==typeof t){if(V(e)){if(null==s)return;"object"==typeof s&&(t=s)}else{"string"==typeof e&&(e=e.split("."));var i=e.pop();(function(t,e,s){var i=t;if(V(e));else{var n;"string"==typeof e&&(e=e.split("."));for(var r=0,a=e.length;r<a;r++){var h;if(null==i[n=e[r]]||"object"!=typeof i[n])h=r===a-1?void 0===s?{}:s:{},i[n]=h;i=i[n]}}return i}(t,e))[i]=s}return t}};const H=Phaser.GameObjects.GameObject;var L=function(t){return t instanceof H};w.register("tap",(function(t,e){return L(t)||(e=t,t=this.scene),new Y(t,e)})),W(window,"RexPlugins.Gestures.Tap",Y);const J=Phaser.Utils.Objects.GetValue;const z="IDLE",Z="BEGIN",q="RECOGNIZED";var Q=class extends B{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.x=0,s.y=0,s.worldX=0,s.worldY=0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.start()},exit:function(){s.stop()}},RECOGNIZED:{enter:function(){s.emit("pressstart",s,s.gameObject,s.lastPointer)},exit:function(){s.emit("pressend",s,s.gameObject,s.lastPointer)}}},init:function(){this.state=z},eventEmitter:!1};this.setRecongizedStateObject(new A(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(J(t,"threshold",9)),this.setMinHoldTime(J(t,"time",251)),this}onDragStart(){this.state=Z,0===this.holdTime&&(this.state=q)}onDragEnd(){this.state=z}onDrag(){this.state!==z&&this.pointer.getDistance()>this.dragThreshold&&(this.state=z)}preUpdate(t,e){this.state===Z&&(t-this.pointer.downTime>=this.holdTime&&(this.state=q))}get isPressed(){return this.state===q}setDragThreshold(t){return this.dragThreshold=t,this}setMinHoldTime(t){return this.holdTime=t,this}};w.register("press",(function(t,e){return L(t)||(e=t,t=this.scene),new Q(t,e)})),W(window,"RexPlugins.Gestures.Press",Q);const K=Phaser.Utils.Objects.GetValue;const $="IDLE",tt="BEGIN",et="RECOGNIZED";var st=class extends B{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{},BEGIN:{enter:function(){var t=s.pointer;s.startX=t.x,s.startY=t.y,s.startWorldX=t.worldX,s.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){s.emit("panstart",s,s.gameObject,s.lastPointer)},exit:function(){var t=s.lastPointer;s.endX=t.x,s.endY=t.y,s.endWorldX=t.worldX,s.endWorldY=t.worldY,s.emit("panend",s,s.gameObject,s.lastPointer)}}},init:function(){this.state=$},eventEmitter:!1};this.setRecongizedStateObject(new A(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(K(t,"threshold",10)),this}onDragStart(){this.state=tt,0===this.dragThreshold&&(this.state=et)}onDragEnd(){this.state=$}onDrag(){switch(this.state){case tt:this.pointer.getDistance()>=this.dragThreshold&&(this.state=et);break;case et:var t=this.pointer.position,e=this.pointer.prevPosition;this.dx=t.x-e.x,this.dy=t.y-e.y;var s=this.pointer;this.x=s.x,this.y=s.y,this.worldX=s.worldX,this.worldY=s.worldY,this.emit("pan",this,this.gameObject,this.lastPointer)}}get isPan(){return this.state===et}setDragThreshold(t){return this.dragThreshold=t,this}};w.register("pan",(function(t,e){return L(t)||(e=t,t=this.scene),new st(t,e)})),W(window,"RexPlugins.Gestures.Pan",st);const it=Phaser.Math.Distance.Between,nt=Phaser.Math.Angle.Between;var rt={getDt:function(){return this.scene.sys.game.loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return it(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return nt(e.x,e.y,t.x,t.y)}},at={"up&down":0,"left&right":1,"4dir":2,"8dir":3},ht={},ot=function(t,e,s){switch(void 0===s?s={}:!0===s&&(s=ht),s.left=!1,s.right=!1,s.up=!1,s.down=!1,t=(t+360)%360,e){case 0:t<180?s.down=!0:s.up=!0;break;case 1:t>90&&t<=270?s.left=!0:s.right=!0;break;case 2:t>45&&t<=135?s.down=!0:t>135&&t<=225?s.left=!0:t>225&&t<=315?s.up=!0:s.right=!0;break;case 3:t>22.5&&t<=67.5?(s.down=!0,s.right=!0):t>67.5&&t<=112.5?s.down=!0:t>112.5&&t<=157.5?(s.down=!0,s.left=!0):t>157.5&&t<=202.5?s.left=!0:t>202.5&&t<=247.5?(s.left=!0,s.up=!0):t>247.5&&t<=292.5?s.up=!0:t>292.5&&t<=337.5?(s.up=!0,s.right=!0):s.right=!0}return s};const dt=Phaser.Utils.Objects.GetValue,ct=Phaser.Math.RadToDeg;class lt extends B{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.x=0,s.y=0,s.worldX=0,s.worldY=0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.validDrag=!1}},RECOGNIZED:{enter:function(){s.start(),s.updateDirectionStates(),s.emit("swipe",s,s.gameObject,s.lastPointer)},exit:function(){s.stop(),s.clearDirectionStates()}}},init:function(){this.state=pt},eventEmitter:!1};this.setRecongizedStateObject(new A(i)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(dt(t,"threshold",10)),this.setMinDragVelocity(dt(t,"velocityThreshold",1e3)),this.setDirectionMode(dt(t,"dir","8dir")),this}onDragStart(){this.state=gt}onDragEnd(){this.state=pt}onDrag(){this.state===gt&&(this.validDrag||(this.validDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.validDrag&&this.dragVelocity>this.minDragVelocity&&(this.state=ut))}postUpdate(t,e){this.state===ut&&(this.state=pt)}get isSwiped(){return this.state===ut}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityY();break;case 1:t=this.getVelocityX();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setMinDragVelocity(t){return this.minDragVelocity=t,this}setDirectionMode(t){return"string"==typeof t&&(t=at[t]),this.dirMode=t,this}updateDirectionStates(){var t=ct(this.getVelocityAngle());return ot(t,this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(lt.prototype,rt);const pt="IDLE",gt="BEGIN",ut="RECOGNIZED";var mt=lt;w.register("swipe",(function(t,e){return L(t)||(e=t,t=this.scene),new mt(t,e)})),W(window,"RexPlugins.Gestures.Swipe",mt);var vt=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]};const ft=Phaser.Utils.Objects.GetValue,bt=Phaser.Utils.Array.SpliceOne,wt=Phaser.Math.Distance.Between,yt=Phaser.Math.Angle.Between;class St{constructor(t,e){var s=t.input.manager.pointersTotal-1;s<2&&t.input.addPointer(2-s),this.scene=t,this.setEventEmitter(ft(e,"eventEmitter",void 0)),this._enable=void 0,this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(ft(t,"enable",!0)),this.bounds=ft(t,"bounds",void 0),this.tracerState=Dt,this.pointers.length=0,vt(this.movedState),this}boot(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointers.length=0,vt(this.movedState),this.scene&&(this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0}destroy(){this.shutdown()}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.dragCancel(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}onPointerDown(t){if(this.enable&&(2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t)))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.tracerState){case Dt:this.tracerState=Tt,this.onDrag1Start();break;case Tt:this.tracerState=xt,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],bt(this.pointers,e),this.tracerState){case Tt:this.tracerState=Dt,this.onDrag1End();break;case xt:this.tracerState=Tt,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),s=-1!==this.pointers.indexOf(t);if(!s&&e);else if(s&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case Tt:this.onDrag1();break;case xt:this.onDrag2()}}}dragCancel(){return this.tracerState===xt&&this.onDrag2End(),this.pointers.length=0,vt(this.movedState),this.tracerState=Dt,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==xt)return 0;var t=this.pointers[0],e=this.pointers[1];return wt(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==xt)return 0;var t=this.pointers[0],e=this.pointers[1];return yt(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,s=t.prevPosition;Et.x=e.x-s.x,Et.y=e.y-s.y}else Et.x=0,Et.y=0;return Et}get centerX(){if(this.tracerState!==xt)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==xt)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==xt)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==xt)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Ot,this}}Object.assign(St.prototype,y);var Et={};const Dt=0,Tt=1,xt=2,Ot="IDLE";var Pt=St;const kt=Phaser.Utils.Objects.GetValue;const _t="IDLE",Ct="BEGIN",Mt="RECOGNIZED";var Bt=class extends Pt{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.prevDistance=void 0,s.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){s.emit("pinchstart",s)},exit:function(){s.emit("pinchend",s)}}},init:function(){this.state=_t},eventEmitter:!1};this.setRecongizedStateObject(new A(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(kt(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=Ct,0===this.dragThreshold&&(this.state=Mt)}onDrag2End(){this.state=_t}onDrag2(){switch(this.state){case Ct:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=Mt}break;case Mt:t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinch(){return this.state===Mt}setDragThreshold(t){return this.dragThreshold=t,this}};w.register("pinch",(function(t){return new Bt(this.scene,t)})),W(window,"RexPlugins.Gestures.Pinch",Bt);const It=Phaser.Math.RotateAround;var jt=function(t,e,s,i){return It(t,e,s,i),t.rotation+=i,t},Rt={},At=function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var s=this.movementCenterX,i=this.movementCenterY;e.getWorldPoint(this.centerX,this.centerY,Rt);var n=Rt.x,r=Rt.y,a=this.rotation;if(Array.isArray(t))for(var h=t,o=0,d=h.length;o<d;o++)(t=h[o]).x+=s,t.y+=i,jt(t,n,r,a);else t.x+=s,t.y+=i,jt(t,n,r,a);return this};const Ft=Phaser.Utils.Objects.GetValue,Nt=Phaser.Math.Angle.WrapDegrees,Gt=Phaser.Math.Angle.ShortestBetween,Ut=Phaser.Math.RadToDeg,Xt=Phaser.Math.DegToRad;class Yt extends Pt{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.prevAngle=void 0,s.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){s.emit("rotatestart",s)},exit:function(){s.emit("rotateend",s)}}},init:function(){this.state=Wt},eventEmitter:!1};this.setRecongizedStateObject(new A(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Ft(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=Nt(Ut(this.angleBetween)),this.state=Ht,0===this.dragThreshold&&(this.state=Lt)}onDrag2End(){this.state=Wt}onDrag2(){switch(this.state){case Ht:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=Nt(Ut(this.angleBetween));this.angle=Gt(this.prevAngle,t),this.prevAngle=t,this.state=Lt}break;case Lt:t=Nt(Ut(this.angleBetween));this.angle=Gt(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotation(){return this.state===Lt}get rotation(){return Xt(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var Vt={spinObject:At};Object.assign(Yt.prototype,Vt);const Wt="IDLE",Ht="BEGIN",Lt="RECOGNIZED";var Jt=Yt;w.register("rotate",(function(t){return new Jt(this.scene,t)})),W(window,"RexPlugins.Gestures.Rotate",Jt);class zt extends Phaser.Plugins.ScenePlugin{constructor(t,e){super(t,e),this.add=new w(t)}}var Zt=zt;class qt extends Phaser.Game{constructor(){super({type:Phaser.AUTO,parent:"game",width:600,height:900,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},roundPixels:!0,plugins:{scene:[{key:"rexGestures",plugin:Zt,mapping:"rexGestures"}]}}),this.scene.add("boot",i,!1),this.scene.add("load",n,!1),this.scene.add("menu",d,!1),this.scene.add("teach",c,!1),this.scene.add("play",v,!1),this.scene.add("over",f,!1),this.scene.start("boot")}}window.game=new qt}]);